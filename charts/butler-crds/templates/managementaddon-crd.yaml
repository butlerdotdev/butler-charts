{{/*
Copyright 2026 The Butler Authors.
SPDX-License-Identifier: Apache-2.0
*/}}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: managementaddons.butler.butlerlabs.dev
  labels:
    {{- include "butler-crds.labels" . | nindent 4 }}
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
    {{- with .Values.annotations }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
spec:
  group: butler.butlerlabs.dev
  names:
    kind: ManagementAddon
    listKind: ManagementAddonList
    plural: managementaddons
    singular: managementaddon
    shortNames:
      - ma
      - maddon
  scope: Cluster
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Addon
          type: string
          jsonPath: .spec.addon
          description: Addon name
        - name: Version
          type: string
          jsonPath: .spec.version
          description: Requested version
        - name: Phase
          type: string
          jsonPath: .status.phase
          description: Current phase
        - name: Installed
          type: string
          jsonPath: .status.installedVersion
          description: Installed version
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
      schema:
        openAPIV3Schema:
          type: object
          description: ManagementAddon is the Schema for the managementaddons API. It represents an addon to be installed on the management cluster.
          properties:
            apiVersion:
              type: string
              description: API version
            kind:
              type: string
              description: Kind
            metadata:
              type: object
            spec:
              type: object
              description: ManagementAddonSpec defines the desired state of ManagementAddon
              required:
                - addon
              properties:
                addon:
                  type: string
                  description: Addon is the name of the addon to install (must match an AddonDefinition)
                  minLength: 1
                version:
                  type: string
                  description: Version is the specific version to install. If not specified, uses the default version from the AddonDefinition.
                values:
                  type: object
                  description: Values are the Helm values to use for installation.
                  x-kubernetes-preserve-unknown-fields: true
                paused:
                  type: boolean
                  description: Paused indicates whether reconciliation of this addon is paused.
            status:
              type: object
              description: ManagementAddonStatus defines the observed state of ManagementAddon
              properties:
                phase:
                  type: string
                  description: Phase represents the current phase of the addon installation
                  enum:
                    - Pending
                    - Installing
                    - Installed
                    - Upgrading
                    - Failed
                    - Uninstalling
                installedVersion:
                  type: string
                  description: InstalledVersion is the currently installed version of the addon
                helmRelease:
                  type: object
                  description: HelmRelease contains information about the Helm release
                  properties:
                    name:
                      type: string
                      description: Name of the Helm release
                    namespace:
                      type: string
                      description: Namespace where the release is installed
                    version:
                      type: integer
                      description: Revision number of the release
                message:
                  type: string
                  description: Message provides additional information about the current state
                lastAttemptedVersion:
                  type: string
                  description: LastAttemptedVersion is the version that was last attempted to install
                conditions:
                  type: array
                  description: Conditions represent the latest available observations
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
                    required:
                      - type
                      - status
                observedGeneration:
                  type: integer
                  format: int64
                  description: ObservedGeneration is the last observed generation
