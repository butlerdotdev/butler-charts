{{/*
AUTO-GENERATED FROM butler-api - DO NOT EDIT
Source: config/crd/bases/butler.butlerlabs.dev_workspaces.yaml
*/}}
{{- if .Values.crds.workspace }}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
    {{- include "butler-crds.annotations" . | nindent 4 }}
  labels:
    {{- include "butler-crds.labels" . | nindent 4 }}
  name: workspaces.butler.butlerlabs.dev
spec:
  group: butler.butlerlabs.dev
  names:
    kind: Workspace
    listKind: WorkspaceList
    plural: workspaces
    shortNames:
    - ws
    singular: workspace
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Current lifecycle phase
      jsonPath: .status.phase
      name: Phase
      type: string
    - description: Target tenant cluster
      jsonPath: .spec.clusterRef.name
      name: Cluster
      type: string
    - description: Workspace owner email
      jsonPath: .spec.owner
      name: Owner
      type: string
    - description: Container image
      jsonPath: .spec.image
      name: Image
      type: string
    - description: SSH service active
      jsonPath: .status.connected
      name: Connected
      type: boolean
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Workspace represents a cloud development environment running inside a tenant cluster.
          The Workspace CRD lives on the management cluster (in the team namespace),
          while the actual pod, PVC, and SSH service are created in the tenant cluster's
          "workspaces" namespace by the workspace controller.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: WorkspaceSpec defines the desired state of a Workspace.
            properties:
              autoStopAfter:
                default: 8h
                description: |-
                  AutoStopAfter stops the workspace pod after this duration of no SSH connections.
                  Measured from last disconnect time. PVC persists.
                  Set to 0 to disable auto-stop.
                type: string
              clusterRef:
                description: |-
                  ClusterRef references the TenantCluster this workspace runs in.
                  The workspace pod is created in the tenant cluster's "workspaces" namespace.
                properties:
                  name:
                    description: Name is the name of the resource.
                    minLength: 1
                    type: string
                required:
                - name
                type: object
              dotfiles:
                description: Dotfiles repo to clone and run install script on first
                  creation.
                properties:
                  installCommand:
                    description: |-
                      InstallCommand to run after cloning. If not specified, the controller
                      looks for install.sh, install, bootstrap.sh, bootstrap, setup.sh, setup, or Makefile.
                    type: string
                  url:
                    description: URL is the Git repository URL for dotfiles.
                    type: string
                required:
                - url
                type: object
              editorConfig:
                description: EditorConfig holds per-editor configuration (e.g. Neovim
                  config repo).
                properties:
                  neovimConfigArchive:
                    description: |-
                      NeovimConfigArchive is a base64-encoded tar.gz archive of a Neovim config directory.
                      Extracted to ~/.config/nvim on workspace creation. Supports multi-file configs
                      (init.lua + lua/ subdirectories). Ignored if NeovimConfigRepo is set.
                    type: string
                  neovimConfigRepo:
                    description: |-
                      NeovimConfigRepo is a Git URL for a Neovim configuration.
                      Cloned to ~/.config/nvim on first workspace creation.
                    type: string
                  neovimInitLua:
                    description: |-
                      NeovimInitLua is inline init.lua content written to ~/.config/nvim/init.lua.
                      Use this when the config is not in a git repo. Ignored if NeovimConfigRepo is set.
                    type: string
                type: object
              envFrom:
                description: |-
                  EnvFrom copies environment variables from an existing workload
                  running in the tenant cluster.
                properties:
                  container:
                    description: Container name within the workload. Defaults to first
                      container.
                    type: string
                  kind:
                    default: Deployment
                    description: Kind of the source workload.
                    enum:
                    - Deployment
                    - StatefulSet
                    type: string
                  name:
                    description: Name of the workload to copy env from.
                    type: string
                  namespace:
                    default: default
                    description: Namespace of the workload in the tenant cluster.
                      Defaults to "default".
                    type: string
                required:
                - name
                type: object
              idleTimeout:
                default: 4h
                description: |-
                  IdleTimeout after which the SSH service is torn down.
                  Pod and PVC persist. Only the network path is removed.
                  Measured from connect time (no activity tracking).
                type: string
              image:
                description: Image is the workspace container image.
                type: string
              owner:
                description: |-
                  Owner is the email of the Butler user who owns this workspace.
                  Set by the server from the authenticated user's JWT.
                minLength: 1
                type: string
              repositories:
                description: |-
                  Repositories is a list of Git repositories to clone into the workspace.
                  Each repository is cloned as a sibling directory under /workspace/{repo-name}/.
                  When multiple repositories are specified, a VS Code .code-workspace file
                  is generated automatically.
                items:
                  description: WorkspaceRepository configures a Git repository to
                    clone into the workspace.
                  properties:
                    branch:
                      default: main
                      description: Branch to checkout.
                      type: string
                    name:
                      description: |-
                        Name is the directory name under /workspace/ to clone into.
                        If empty, derived from the repository URL (e.g., "butler-api" from
                        "https://github.com/butlerdotdev/butler-api").
                      type: string
                    secretRef:
                      description: |-
                        SecretRef for Git credentials (SSH key or token).
                        References a Secret in the team namespace on the management cluster.
                        The controller copies it to the tenant cluster's workspaces namespace.
                      properties:
                        name:
                          description: Name is the name of the resource.
                          minLength: 1
                          type: string
                      required:
                      - name
                      type: object
                    url:
                      description: URL is the Git repository URL.
                      type: string
                  required:
                  - url
                  type: object
                type: array
              repository:
                description: |-
                  Repository to clone into the workspace on creation.
                  Deprecated: Use Repositories for multi-repo support.
                properties:
                  branch:
                    default: main
                    description: Branch to checkout.
                    type: string
                  name:
                    description: |-
                      Name is the directory name under /workspace/ to clone into.
                      If empty, derived from the repository URL (e.g., "butler-api" from
                      "https://github.com/butlerdotdev/butler-api").
                    type: string
                  secretRef:
                    description: |-
                      SecretRef for Git credentials (SSH key or token).
                      References a Secret in the team namespace on the management cluster.
                      The controller copies it to the tenant cluster's workspaces namespace.
                    properties:
                      name:
                        description: Name is the name of the resource.
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                  url:
                    description: URL is the Git repository URL.
                    type: string
                required:
                - url
                type: object
              resources:
                description: Resources for the workspace pod.
                properties:
                  cpu:
                    default: "2"
                    description: CPU request and limit for the workspace.
                    type: string
                  memory:
                    default: 4Gi
                    description: Memory request and limit for the workspace.
                    type: string
                type: object
              sshPublicKeys:
                description: |-
                  SSHPublicKeys for authorized access. If empty, keys are resolved
                  from the owner's User profile (spec.sshKeys).
                items:
                  type: string
                type: array
              storageSize:
                anyOf:
                - type: integer
                - type: string
                default: 10Gi
                description: StorageSize for the workspace PVC.
                pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                x-kubernetes-int-or-string: true
            required:
            - clusterRef
            - image
            - owner
            type: object
          status:
            description: WorkspaceStatus defines the observed state of Workspace.
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of the workspace's state.
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              connected:
                description: Connected indicates whether the SSH service is currently
                  active.
                type: boolean
              lastActivityTime:
                description: |-
                  LastActivityTime tracks the last SSH connect time.
                  Used for idle timeout calculation.
                format: date-time
                type: string
              lastDisconnectTime:
                description: |-
                  LastDisconnectTime tracks when the SSH service was last removed.
                  Used for auto-stop calculation.
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration is the last observed generation of
                  the workspace spec.
                format: int64
                type: integer
              phase:
                description: Phase of the workspace lifecycle.
                enum:
                - Pending
                - Creating
                - Running
                - Starting
                - Stopped
                - Failed
                type: string
              podName:
                description: PodName is the name of the workspace pod in the tenant
                  cluster.
                type: string
              pvcName:
                description: PVCName is the name of the workspace PVC in the tenant
                  cluster.
                type: string
              serviceName:
                description: ServiceName is the SSH service name when connected.
                type: string
              sshEndpoint:
                description: SSHEndpoint is the IP:port for SSH access when connected.
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
{{- end }}
