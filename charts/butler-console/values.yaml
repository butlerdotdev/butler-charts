# Butler Console Helm Chart Values
# Web-based management console with server (API) and frontend (UI) components

# Global settings
global:
  # -- Image pull secrets for all components
  imagePullSecrets: []

# Server (API) configuration
server:
  # -- Enable server component
  enabled: true

  # -- Number of server replicas
  replicaCount: 1

  image:
    # -- Server image repository
    repository: ghcr.io/butlerdotdev/butler-server
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Image tag (defaults to chart appVersion)
    tag: ""

  # -- Pod annotations
  podAnnotations: {}

  # -- Pod labels
  podLabels: {}

  # -- Pod security context
  podSecurityContext:
    runAsNonRoot: true
    seccompProfile:
      type: RuntimeDefault

  # -- Container security context
  securityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL
    readOnlyRootFilesystem: true

  # -- Resource requests and limits
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # Service configuration
  service:
    # -- Service type
    type: ClusterIP
    # -- API port
    port: 8080

  # Server configuration
  config:
    # -- Log level (debug, info, warn, error)
    logLevel: info
    # -- Metrics bind address
    metricsBindAddress: ":9090"
    # -- Base URL for Butler Console (used for OAuth redirects, invite links)
    # Example: https://butler.example.com
    baseURL: ""
    # -- Tenant namespace for Butler resources
    tenantNamespace: "butler-tenants"
    # -- System namespace for Butler system resources
    systemNamespace: "butler-system"
    # -- Frontend URL (for dev mode when frontend runs separately)
    frontendURL: ""

  # Authentication configuration
  auth:
    # -- JWT secret for signing session tokens
    # For production, use existingSecret instead
    jwtSecret: ""
    # -- Reference to existing secret containing JWT secret
    # Key should be "jwt-secret"
    existingSecret: ""
    # -- Session expiry duration (e.g., "24h", "168h")
    sessionExpiry: "24h"
    # -- Enable secure cookies (should be true in production with HTTPS)
    secureCookies: false

    # Platform Admin auth (bootstrap admin for initial setup)
    platform:
      # -- Enable bootstrap admin authentication
      # When enabled, creates an admin user that can authenticate with username/password
      # Recommended to disable after configuring OIDC/SSO
      enabled: true
      # -- Admin username for basic auth
      adminUsername: "admin"
      # -- Admin password for basic auth
      # If not set, a random 24-character password will be generated
      # Retrieve with: kubectl get secret <release>-butler-console-admin -n <namespace> -o jsonpath='{.data.admin-password}' | base64 -d
      adminPassword: ""
      # -- Use an existing secret for admin credentials instead of creating one
      # Secret must contain key specified by existingSecretKey
      existingSecret: ""
      # -- Key in existingSecret containing the admin password
      existingSecretKey: "admin-password"

  # OIDC authentication configuration
  oidc:
    # -- Enable OIDC authentication
    # Auto-enabled if issuerURL and clientID are set
    enabled: false
    # -- OIDC provider issuer URL
    # Examples:
    #   Google: https://accounts.google.com
    #   Microsoft: https://login.microsoftonline.com/{tenant-id}/v2.0
    #   Okta: https://{domain}.okta.com
    issuerURL: ""
    # -- OAuth2 client ID
    clientID: ""
    # -- OAuth2 client secret (use existingSecret for production)
    clientSecret: ""
    # -- Reference to existing secret containing OIDC credentials
    # Expected keys: "client-id", "client-secret"
    existingSecret: ""
    # -- OAuth2 callback URL
    # Example: https://butler.example.com/api/auth/callback
    redirectURL: ""
    # -- OAuth2 scopes (comma or space separated)
    # Default: openid,email,profile
    scopes: ""
    # -- Restrict to specific domain (Google Workspace only)
    hostedDomain: ""
    # -- JWT claim for group memberships
    groupsClaim: "groups"
    # -- JWT claim for email address
    emailClaim: "email"

  # Pod disruption budget
  podDisruptionBudget:
    # -- Enable PDB
    enabled: false
    # -- Minimum available pods
    minAvailable: 1

# Frontend (UI) configuration
frontend:
  # -- Enable frontend component
  enabled: true

  # -- Number of frontend replicas
  replicaCount: 1

  image:
    # -- Frontend image repository
    repository: ghcr.io/butlerdotdev/butler-console
    # -- Image pull policy
    pullPolicy: IfNotPresent
    # -- Image tag (defaults to chart appVersion)
    tag: ""

  # -- Pod annotations
  podAnnotations: {}

  # -- Pod labels
  podLabels: {}

  # -- Pod security context
  # Note: nginx requires specific permissions. Using seccomp only.
  podSecurityContext:
    seccompProfile:
      type: RuntimeDefault

  # -- Container security context
  # Note: nginx needs write access to temp paths mounted as emptyDir
  securityContext:
    allowPrivilegeEscalation: false

  # -- Resource requests and limits
  resources:
    limits:
      cpu: 200m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # Service configuration
  service:
    # -- Service type
    type: ClusterIP
    # -- HTTP port (service port, nginx listens on 8080 internally)
    port: 80

  # Pod disruption budget
  podDisruptionBudget:
    # -- Enable PDB
    enabled: false
    # -- Minimum available pods
    minAvailable: 1

# Service account configuration (shared)
serviceAccount:
  # -- Create a service account
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- Service account name (generated if not set)
  name: ""

# RBAC configuration
rbac:
  # -- Create RBAC resources
  create: true

# Ingress configuration
ingress:
  # -- Enable ingress
  enabled: false
  # -- Ingress class name
  className: ""
  # -- Ingress annotations
  annotations: {}
  # -- Ingress hosts
  hosts:
    - host: butler.local
      paths:
        - path: /api
          pathType: Prefix
          service: server
        - path: /
          pathType: Prefix
          service: frontend
  # -- Ingress TLS configuration
  tls: []
  #  - secretName: butler-tls
  #    hosts:
  #      - butler.local

# -- Node selector (applies to all components)
nodeSelector: {}

# -- Tolerations (applies to all components)
tolerations: []

# -- Affinity rules (applies to all components)
affinity: {}

# -- Override the release name
nameOverride: ""

# -- Override the full release name
fullnameOverride: ""
